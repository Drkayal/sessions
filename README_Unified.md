# 🏠 البوت الموحد - مركز التحكم الشامل

نظام موحد لتوليد وفحص جلسات تيليجرام مع واجهة تفاعلية شاملة.

## 🏗️ **هيكل المشروع الجديد**

```
📁 المشروع
├── 🤖 UnifiedBot.py              # البوت الرئيسي (الواجهة الموحدة)
├── 🔧 Tolid_Functions.py         # دوال توليد وحفظ PostgreSQL
├── 🔍 SessionChecker_Functions.py # دوال فحص الجلسات
├── 🚀 bootstrap_unified.py       # ملف الإعداد والتشغيل
├── 📋 requirements_unified.txt   # المتطلبات الموحدة
├── 📚 README_Unified.md          # هذا الدليل
│
├── 📁 الملفات الأصلية (مرجع)
├── Tolid.py                      # الملف الأصلي (مرجع)
├── SessionChecker.py             # الملف الأصلي (مرجع)
└── bootstrap.py                  # الملف الأصلي (مرجع)
```

## ✨ **المميزات الموحدة**

### 🎯 **الوظائف المتاحة**
- **💾 توليد وحفظ (Tolid)**: توليد الجلسات وحفظها في PostgreSQL
- **🔍 فحص Telethon**: توليد وفحص جلسات تيليثون مع إرسال الصالحة
- **🔍 فحص Pyrogram**: توليد وفحص جلسات بايروجرام مع إرسال الصالحة
- **📁 فحص الملفات**: فحص جلسات من ملفات محفوظة مسبقاً
- **🤖 إدارة البوتات**: إضافة وإدارة بوتات الفحص
- **📊 لوحة تحكم شاملة**: إحصائيات موحدة لجميع العمليات

### 🎮 **الواجهة الموحدة**
- **أزرار تفاعلية** لسهولة الاستخدام
- **تنقل سلس** بين الوظائف المختلفة
- **إحصائيات مجمعة** من جميع العمليات
- **إدارة موحدة** للمهام النشطة

## 🚀 **التثبيت والإعداد**

### 1. تثبيت المتطلبات
```bash
# الطريقة الأولى: استخدام ملف المتطلبات
pip install -r requirements_unified.txt

# الطريقة الثانية: استخدام Bootstrap (موصى به)
python3 bootstrap_unified.py
```

### 2. إعداد المتغيرات البيئية
```bash
# متطلبات أساسية (إجبارية)
export BOT_TOKEN="your_telegram_bot_token"
export BOT_OWNER_ID="your_telegram_user_id"

# متطلبات PostgreSQL (لوظائف Tolid فقط)
export PGHOST="localhost"
export PGPORT="5432"
export PGUSER="postgres"
export PGPASSWORD="your_password"
export PGDATABASE="postgres"
```

أو أنشئ ملف `.env`:
```
BOT_TOKEN=your_telegram_bot_token
BOT_OWNER_ID=your_telegram_user_id
PGHOST=localhost
PGPORT=5432
PGUSER=postgres
PGPASSWORD=your_password
PGDATABASE=postgres
```

### 3. تشغيل البوت
```bash
# الطريقة الأولى: التشغيل المباشر
python3 UnifiedBot.py

# الطريقة الثانية: باستخدام Bootstrap (موصى به)
python3 bootstrap_unified.py
```

## 🎮 **كيفية الاستخدام**

### 🏠 **القائمة الرئيسية**
عند إرسال `/start` ستظهر الخيارات:

```
🏠 مركز التحكم الموحد
├── 💾 توليد وحفظ (Tolid)
├── 🔍 فحص Telethon  
├── 🔍 فحص Pyrogram
├── 📁 فحص ملف محفوظ
├── 🤖 إدارة بوتات الفحص
└── 📊 لوحة التحكم الشاملة
```

### 💾 **استخدام Tolid (توليد وحفظ)**
1. اختر "توليد وحفظ (Tolid)"
2. أدخل عدد الجلسات المطلوبة
3. أدخل اسم قاعدة البيانات
4. أدخل اسم الجدول
5. ستبدأ العملية تلقائياً مع تحديثات التقدم

### 🔍 **استخدام فحص الجلسات**
1. **إضافة بوتات الفحص أولاً**:
   - اختر "إدارة بوتات الفحص"
   - اضغط "إضافة بوت فحص"
   - أرسل توكن البوت

2. **بدء الفحص**:
   - اختر نوع الجلسة (Telethon أو Pyrogram)
   - اضغط "ابدأ الآن"
   - ستصلك الجلسات الصالحة فوراً

### 📁 **فحص الملفات**
1. اختر "فحص ملف محفوظ"
2. أرسل مسار الملف النصي
3. سيتم فحص جميع الجلسات وإرسال الصالحة

### 📊 **لوحة التحكم**
تعرض إحصائيات شاملة:
- المهام النشطة
- إحصائيات Tolid
- إحصائيات فحص الجلسات
- آخر الأنشطة

## 🔧 **الأوامر المتاحة**

| الأمر | الوصف |
|-------|--------|
| `/start` | عرض القائمة الرئيسية |
| `/status` | حالة المهمة النشطة |
| `/cancel` | إيقاف المهمة النشطة |
| `/help` | عرض المساعدة |

## ⚙️ **الإعدادات المتقدمة**

### متغيرات البيئة القابلة للتخصيص
```bash
# إعدادات Tolid
DEFAULT_BATCH=50000              # حجم دفعة التوليد
MAX_WORKERS=8                    # عدد العمليات المتوازية
MAX_PENDING_BATCHES=100          # الحد الأقصى للدفعات المعلقة
HASH_PARTITIONS=64               # عدد أقسام الجدول

# إعدادات SessionChecker
DEFAULT_BATCH=100                # حجم دفعة الفحص (أصغر)
MAX_WORKERS=4                    # عدد خيوط الفحص
```

## 🔄 **الفرق عن النظام القديم**

| الميزة | النظام القديم | النظام الموحد |
|--------|---------------|----------------|
| **عدد البوتات** | 2 منفصلين | بوت واحد موحد |
| **الواجهة** | منفصلة لكل وظيفة | واجهة موحدة |
| **الإحصائيات** | منفصلة | مجمعة وشاملة |
| **سهولة الاستخدام** | تبديل بين البوتات | تنقل سلس |
| **إدارة المهام** | منفصلة | موحدة |
| **الصيانة** | ملفات متعددة | هيكل منظم |

## 🛡️ **الأمان والحماية**

- **مصادقة المالك**: البوت يعمل لمالك واحد فقط
- **فصل الوظائف**: الدوال الوظيفية منفصلة عن الواجهة
- **إدارة الأخطاء**: التعامل التلقائي مع الأخطاء
- **تسجيل شامل**: تسجيل جميع العمليات
- **تجنب التكرار**: لا يتم فحص نفس الجلسة مرتين

## 📊 **مراقبة الأداء**

### إحصائيات Tolid
- إجمالي الجلسات المولدة
- متوسط سرعة التوليد
- إجمالي وقت العمل

### إحصائيات فحص الجلسات
- إجمالي الجلسات المولدة للفحص
- إجمالي الجلسات المفحوصة
- عدد الجلسات الصالحة
- معدل النجاح
- عدد بوتات الفحص النشطة

## 🔧 **استكشاف الأخطاء**

### مشاكل شائعة وحلولها

1. **"وحدة غير متاحة"**
   ```bash
   pip install -r requirements_unified.txt
   # أو
   python3 bootstrap_unified.py
   ```

2. **"لا توجد بوتات فحص"**
   - أضف بوت فحص من "إدارة بوتات الفحص"

3. **"خطأ في قاعدة البيانات"**
   - تأكد من إعداد `PGPASSWORD` و متغيرات PostgreSQL

4. **"فشل في الاستيراد"**
   - تأكد من وجود جميع الملفات في نفس المجلد

## 🎯 **أفضل الممارسات**

1. **استخدم Bootstrap**: دائماً استخدم `bootstrap_unified.py` للتشغيل
2. **أضف بوتات متعددة**: لتحسين سرعة الفحص
3. **راقب الإحصائيات**: استخدم لوحة التحكم للمتابعة
4. **احفظ النتائج**: الجلسات الصالحة ترسل فوراً
5. **استخدم `/cancel`**: لإيقاف المهام بأمان

## 📝 **ملاحظات مهمة**

- **الاستخدام المسؤول**: استخدم النظام بمسؤولية
- **معدل الطلبات**: النظام يدير معدل الطلبات تلقائياً
- **التخزين الذكي**: وظائف Tolid تحفظ في قاعدة البيانات، وظائف الفحص ترسل فوراً
- **التوافق**: يعمل مع Python 3.7+ 

---

🔗 **للدعم والمساعدة**: راجع هذا الدليل أو استخدم `/help` في البوت.